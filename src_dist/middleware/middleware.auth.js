let jwt=require("jsonwebtoken"),UserModel=require("../model/user").UserModel,ResponseModel=require("../model/response").ResponseModel,dataDecrypt=require("../util/crpyto").dataDecrypt;async function AuthToken(t,o,r){try{var s=t.headers.auth;if(!s)return t.id=null,o.status(200).send(new ResponseModel(-99,null,"토큰 없음"));let{a:e,r:n}=JSON.parse(dataDecrypt(s));return jwt.verify(e,process.env.ACCESS_KEY,async(e,s)=>e?jwt.verify(n,process.env.REFRESH_KEY,async(e,s)=>e?o.status(200).send(new ResponseModel(-999,null,"토큰 만료")):(e=s.id,await UserModel.findOne({id:e})?(t.id=e,r()):o.status(200).send(new ResponseModel(403,null,"유저 정보가 조회 되지않는 토큰")))):(e=s.id,await UserModel.findOne({id:e})?(t.id=e,r()):o.status(200).send(new ResponseModel(403,null,"유저 정보가 조회 되지않는 토큰"))))}catch(e){console.log(e,"token")}}module.exports={AuthToken:AuthToken};// build date : 2025. 5. 21. 오후 7:06:44